<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/main.css" rel="stylesheet">
    <link href="/static/css/ie10-viewport-bug-workaround.css" rel="stylesheet">
    <script src="/static/js/ie-emulation-modes-warning.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <title>Flats for friends - поиск жилья без риелтора</title>
  </head>

  <body>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/static/js/bootstrap.min.js"></script>



  <nav class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">Flats for friends</a>
      </div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li class="active"><a href="#">Главная <span class="sr-only">(current)</span></a></li>
          <li><a href="#">Обьекты</a></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Статистика <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="#">Action</a></li>
              <li><a href="#">Another action</a></li>
              <li><a href="#">Something else here</a></li>
              <li role="separator" class="divider"></li>
              <li><a href="#">Separated link</a></li>
              <li role="separator" class="divider"></li>
              <li><a href="#">One more separated link</a></li>
            </ul>
          </li>
        </ul>
      </div><!-- /.navbar-collapse -->
    </div>
  </nav>
  <div class="container">
    <h1><p class="text-center">Найти обьект:</p></h1></br>

<!--     <div class="row">
      <div class="col-md-3">
        Выберите станцию метро: </br>
        <form>
          <div id="dialog_id">
            <select class="form-control" name="text" id="metro_station" onChange="selectChanges(this, value);">
              {% for item in metro_station %}
              <option>{{item|capitalize}}</option>
              {% endfor %}
            </select>
          </div>
          </br>
                <div class="col-md-3">
        <button type="submit" value="Найти" class="btn btn-primary">Фильтровать</button></br>
      </div>
        </form>
      </div>

    </div> -->

    <table>
      <tr>
        <td>
          <b>Станция метро:</b>
        </td>
        <td>
          &nbsp;
        </td>
        <td>
          <form>
          <div id="dialog_id">
            <select class="form-control" name="text" id="metro_station" onChange="selectChanges(this, value);">
              {% for item in metro_station %}
              <option>{{item|capitalize}}</option>
              {% endfor %}
            </select>
          </div>
        </td>
        <td>
          &nbsp;
        </td>
        <td>
            <button type="submit" class="btn btn-primary">Фильтровать</button></br>
        </td>
          </form>
      </tr>
    </table>
    </br>
    <table>
      <tr>
        <td>
          <p><b>Постов в базе:</b> {{posts_count}} </p>
          <p><b>Дата последнего обновления базы: </b> {{db_time_update|string()}}  </p>
        </td>
      </tr>
    </table>
    </br>
    <div class="row">
    {%for row in posts[-16:]%}
      <div class="col-md-5">
        <div class="thumbnail">
          <div class="caption">
            <h4>id: {{row.id}}
                <!-- <script type="text/javascript">
                  var selectedStation = $('#metro_station option:selected').val();
                  document.write(selectedStation);
                </script> -->
            </h4>
            <p>{{row.text[:250]}}</p>
            <p><b>Дата создания:</b> {{row.created_time}}</p>
            <p><b>Дата изменения:</b> {{row.updated_time}}</p>
            <p><b>Автор:</b> {{row.author}}</p>
            <a href="#" class="btn btn-default" role="button">Подробнее</a></p>
          </div>
        </div>
      </div>
    {%endfor%}
    </div>
  </div>

    <script type="text/javascript">
    var selects = $("#dialog_id select");
    for (var key in selects) {
        if (!isNaN(parseFloat(key)) && isFinite(key)) {
            var select = selects[key];
            var nameSelect = $(select).attr('name');
            console.log(nameSelect);
            $(select).val(localStorage.getItem(nameSelect));
        }
    }
    function selectChanges(obj, value) {
        var $obj = $(obj);
        var name = $obj.attr('name');

        // дальше код проверки - нужно ли сохранять 
        var notSaveIn = ['массив', 'ненужных', 'элементов'];
        if (notSaveIn.indexOf(name) === -1) {
            localStorage.setItem(name, value)
            console.log(localStorage.getItem(name));
        }
    }
    </script>

  </body>
</html>


<!-- TODO 

1. Добавить список или чекбокс по типу обьявления: сдам, сниму
2. Выровнять кнопку Фильтровать с селектами
3. Выводить заголовок "Найдены результаты для метро N"
4. Выводить кол-во найденных результатов; время создания поста; последнего обновления; автора поста
5. Добавить возможность ставить ограничение по кол-ву результатов (выпадающий список)
6. Сделать страницу для отдельного поста (при нажатии на кнопку Подробнее)
7. Выводить все обьекты на странице Обьекты
8. Выводить статистику на страницах Статистики
9. Добавить картинку для каждого поста
10. Сделать деплой на сервер
11. Настроить автонаполнение базы
12. HTML сделать шаблонами
-->
